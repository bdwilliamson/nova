<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to `vimp` • vimp</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to `vimp`">
<meta property="og:description" content="vimp">
<meta property="og:image" content="https://bdwilliamson.github.io/vimp/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vimp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction-to-vimp.html">Introduction to `vimp`</a>
    </li>
    <li>
      <a href="../articles/precomputed-regressions.html">Using precomputed regression function estimates in `vimp`</a>
    </li>
    <li>
      <a href="../articles/types-of-vims.html">Types of VIMs</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bdwilliamson/vimp/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="introduction-to-vimp_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to <code>vimp</code>
</h1>
                        <h4 data-toc-skip class="author">Brian D. Williamson</h4>
            
            <h4 data-toc-skip class="date">2021-05-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bdwilliamson/vimp/blob/master/vignettes/introduction-to-vimp.Rmd" class="external-link"><code>vignettes/introduction-to-vimp.Rmd</code></a></small>
      <div class="hidden name"><code>introduction-to-vimp.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor" aria-hidden="true"></a>Introduction</h2>
<p><code>vimp</code> is a package that computes nonparametric estimates of variable importance and provides valid inference on the true importance. The package supports flexible estimation of variable importance based on the difference in nonparametric <span class="math inline">\(R^2\)</span>, classification accuracy, and area under the receiver operating characteristic curve (AUC). These quantities are all nonparametric generalizations of the usual measures in simple parametric models (e.g., linear models). For more details, see the accompanying manuscripts <span class="citation">Williamson, Gilbert, Carone, et al. (2020)</span>, <span class="citation">Williamson, Gilbert, Simon, et al. (2020)</span>, and <span class="citation">Williamson and Feng (2020)</span>.</p>
<p>Variable importance estimates may be computed quickly, depending on the techniques used to estimate the underlying conditional means — if these techniques are slow, then the variable importance procedure will be slow.</p>
<p>The code can handle arbitrary dimensions of features, and may be used to estimate the importance of any single feature or group of features for predicting the outcome. The package also includes functions for cross-validated importance.</p>
<p>The author and maintainer of the <code>vimp</code> package is <a href="https://bdwilliamson.github.io/" class="external-link">Brian Williamson</a>. The methods implemented here have also been implemented in Python under the package <a href="https://github.com/bdwilliamson/vimpy" class="external-link"><code>vimpy</code></a>.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor" aria-hidden="true"></a>Installation</h2>
<p>A stable version of the package may be downloaded and installed from CRAN. Type the following command in your R console to install the stable version of <code>vimp</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"vimp"</span><span class="op">)</span></code></pre></div>
<p>A development version of the package may be downloaded and installed from GitHub using the <code>devtools</code> package. Type the following command in your R console to install the development version of <code>vimp</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># only run if you don't have devtools</span>
<span class="co"># previously installed</span>
<span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"bdwilliamson/vimp"</span><span class="op">)</span></code></pre></div>
</div>
<div id="quick-start" class="section level2">
<h2 class="hasAnchor">
<a href="#quick-start" class="anchor" aria-hidden="true"></a>Quick Start</h2>
<p>This section should serve as a quick guide to using the <code>vimp</code> package — we will cover the main functions for estimating <span class="math inline">\(R^2\)</span>-based variable importance using a simulated data example. More details are given in the next section.</p>
<p>First, load the <code>vimp</code> package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://bdwilliamson.github.io/vimp/">"vimp"</a></span><span class="op">)</span></code></pre></div>
<p>Next, create some data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># -------------------------------------------------------------</span>
<span class="co"># problem setup</span>
<span class="co"># -------------------------------------------------------------</span>
<span class="co"># set up the data</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">5678910</span><span class="op">)</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">s</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># desire importance for X_1</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">p</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="fl">7</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">25</span><span class="op">/</span><span class="fl">9</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>
<span class="co"># set up folds for hypothesis testing</span>
<span class="va">folds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>This creates a matrix of covariates <code>x</code> with two columns, a vector <code>y</code> of normally-distributed outcome values, and a set of folds for a sample of <code>n = 100</code> study participants.</p>
<p>The workhorse function of <code>vimp</code>, for <span class="math inline">\(R^2\)</span>-based variable importance, is <code>vimp_rsquared</code>. There are two ways to compute variable importance: in the first method, you allow <code>vimp</code> to run regressions for you and return variable importance; in the second method (discussed in <a href="precomputed-regressions.html">“Using precomputed regression function estimates in <code>vimp</code>”</a>), you run the regressions yourself and plug these into <code>vimp</code>. I will focus on the first method here. The basic arguments are</p>
<ul>
<li>Y: the outcome (in this example, <code>y</code>)</li>
<li>X: the covariates (in this example, <code>x</code>)</li>
<li>indx: the covariate(s) of interest for evaluating importance (here, either 1 or 2)</li>
<li>run_regression: a logical value telling <code>vimp_rsquared</code> whether or not to run a regression of Y on X (<code>TRUE</code> in this example)</li>
<li>SL.library: a “library” of learners to pass to the function <code>SuperLearner</code> (since <code>run_regression = TRUE</code>)</li>
<li>V: the number of folds to use for cross-fitted variable importance</li>
</ul>
<p>This second-to-last argument, <code>SL.library</code>, determines the estimators you want to use for the conditional mean of Y given X. Estimates of variable importance rely on good estimators of the conditional mean, so we suggest using flexible estimators and model stacking to do so. One option for this is the <code>SuperLearner</code> package; load that package using</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/ecpolley/SuperLearner" class="external-link">"SuperLearner"</a></span><span class="op">)</span>
<span class="co"># load specific algorithms</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/imbs-hl/ranger" class="external-link">"ranger"</a></span><span class="op">)</span></code></pre></div>
<p>The code</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">est_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vimp_rsquared.html">vimp_rsquared</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">y</span>, X <span class="op">=</span> <span class="va">x</span>, indx <span class="op">=</span> <span class="fl">1</span>, run_regression <span class="op">=</span> <span class="cn">TRUE</span>,
SL.library <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.ranger"</span>, <span class="st">"SL.mean"</span><span class="op">)</span>, V <span class="op">=</span> <span class="fl">2</span>, env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>uses the Super Learner to fit the required regression functions, and computes an estimate of variable importance for the importance of <span class="math inline">\(X_1\)</span>. We can visualize the estimate, standard error, and confidence interval by printing or typing the object name:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">est_1</span></code></pre></div>
<pre><code>## Variable importance estimates:
##       Estimate   SE         95% CI         VIMP &gt; 0 p-value  
## s = 1 0.01606531 0.04752334 [0, 0.1092093] FALSE    0.3676624</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">est_1</span><span class="op">)</span></code></pre></div>
<pre><code>## Variable importance estimates:
##       Estimate   SE         95% CI         VIMP &gt; 0 p-value  
## s = 1 0.01606531 0.04752334 [0, 0.1092093] FALSE    0.3676624</code></pre>
<p>This output shows that we have estimated the importance of <span class="math inline">\(X_1\)</span> to be 0.016, with a 95% confidence interval of [0, 0.109].</p>
</div>
<div id="detailed-guide" class="section level2">
<h2 class="hasAnchor">
<a href="#detailed-guide" class="anchor" aria-hidden="true"></a>Detailed guide</h2>
<p>In this section, we provide a fuller example of estimating <span class="math inline">\(R^2\)</span>-based variable importance in the context of the South African heart disease study data <span class="citation">(Hastie, Tibshirani, and Friedman 2009)</span>.</p>
<p>Often when working with data we attempt to estimate the conditional mean of the outcome <span class="math inline">\(Y\)</span> given features <span class="math inline">\(X\)</span>, defined as <span class="math inline">\(\mu_P(x) = E_P(Y \mid X = x)\)</span>.</p>
<p>There are many tools for estimating this conditional mean. We might choose a classical parametric tool such as linear regression. We might also want to be model-agnostic and use a more nonparametric approach to estimate the conditional mean. However,</p>
<ul>
<li>This involves using some nonparametric smoothing technique, which requires: (1) choosing a technique, and (2) selecting tuning parameters</li>
<li>Naive optimal tuning balances out the bias and variance of the smoothing estimator. Is this the correct trade-off for estimating the conditional mean?</li>
</ul>
<p>Once we have a good estimate of the conditional mean, it is often of scientific interest to understand which features contribute the most to the variation in <span class="math inline">\(\mu_P\)</span>. Specifically, we might consider <span class="math display">\[\mu_{P, s}(x) = E_P(Y \mid X_{(-s)} = x_{(-s)}),\]</span> where for a vector <span class="math inline">\(v\)</span> and a set of indices <span class="math inline">\(s\)</span>, <span class="math inline">\(v_{-(s)}\)</span> denotes the elements of <span class="math inline">\(v\)</span> with index not in <span class="math inline">\(s\)</span>. By comparing <span class="math inline">\(\mu_{P, s}\)</span> to <span class="math inline">\(\mu_P\)</span> we can evaluate the importance of the <span class="math inline">\(s\)</span>th element (or group of elements).</p>
<p>Assume that our data are generated according to the mechanism <span class="math inline">\(P_0\)</span>. We define the population <span class="math inline">\(R^2\)</span> value of a given regression function <span class="math inline">\(\mu\)</span> as <span class="math inline">\(R^2(\mu, P_0) = 1 - \frac{E_{P_0}\{Y - \mu(X)\}^2}{var_{P_0}(Y)}\)</span>, where the numerator of this expression is the population mean squared error and the denominator is the population variance. We can then define a nonparametric measure of variable importance, <span class="math display">\[\psi_{0, s} = R^2(\mu_{P_0}, P_0) - R^2(\mu_{P_0,s}, P_0),\]</span> which is the proportion of the variability in the outcome explained by including <span class="math inline">\(X_j\)</span> in our chosen estimation technique.</p>
<p>This document introduces you to the basic tools in <code>vimp</code> and how to apply them to a dataset. I will explore one method for obtaining variable estimates using <code>vimp</code>: you only specify a <em>library</em> of candidate estimators for the conditional means <span class="math inline">\(\mu_{P_0}\)</span> and <span class="math inline">\(\mu_{P_0, s}\)</span>; you allow <code>vimp</code> to obtain the optimal estimates of these quantities using the <code>SuperLearner</code> <span class="citation">(van der Laan, Polley, and Hubbard 2007)</span>, and use these estimates to obtain variable importance estimates. A second method (using precomputed estimates of the regression functions) exists and is described in <a href="precomputed-regressions.html">“Using precomputed regression function estimates in <code>vimp</code>”</a>.</p>
<div id="a-look-at-the-south-african-heart-disease-study-data" class="section level3">
<h3 class="hasAnchor">
<a href="#a-look-at-the-south-african-heart-disease-study-data" class="anchor" aria-hidden="true"></a>A look at the South African heart disease study data</h3>
<p>Throughout this document I will use the South African heart disease study data <span class="citation">(Hastie, Tibshirani, and Friedman 2009)</span>, freely available from the <a href="https://web.stanford.edu/~hastie/ElemStatLearn/datasets/SAheart.data" class="external-link">Elements of Statistical Learning website</a>. Information about these data is available <a href="https://web.stanford.edu/~hastie/ElemStatLearn/datasets/SAheart.info.txt" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># read in the data from the Elements website</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"RCurl"</span><span class="op">)</span>
<span class="va">heart_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RCurl/man/getURL.html" class="external-link">getURL</a></span><span class="op">(</span><span class="st">"http://web.stanford.edu/~hastie/ElemStatLearn/datasets/SAheart.data"</span><span class="op">)</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co"># minor data cleaning</span>
<span class="va">heart</span> <span class="op">&lt;-</span> <span class="va">heart_data</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">heart_data</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
<span class="va">heart</span><span class="op">$</span><span class="va">famhist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">heart</span><span class="op">$</span><span class="va">famhist</span> <span class="op">==</span> <span class="st">"Present"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>
<span class="co"># sample-splitting folds for hypothesis testing</span>
<span class="va">heart_folds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">heart</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>In addition to the indicator of myocardial infarction <code>chd</code>, the outcome of interest, there are measurements on two groups of variables. First are behavioral features: cumulative tobacco consumption, current alcohol consumption, and type A behavior (a behavioral pattern linked to stress). Second are biological features: systolic blood pressure, low-density lipoprotein (LDL) cholesterol, adiposity (similar to body mass index), family history of heart disease, obesity, and age.</p>
<p>Since there are nine features and two groups, it is of interest to determine variable importance both for the nine individual features separately and for the two groups of features.</p>
</div>
<div id="a-first-approach-linear-regression" class="section level3">
<h3 class="hasAnchor">
<a href="#a-first-approach-linear-regression" class="anchor" aria-hidden="true"></a>A first approach: linear regression</h3>
<p>Suppose that I believe that a linear model truly describes the relationship between the outcome and the covariates in these data. In that case, I would be justified in only fitting a linear regression to estimate the conditional means; this means that in my importance analysis, I should also use only linear regression. Note that because I chose to fit the regression functions first and then plug them into <code>vimp</code>, I need to explicitly specify the folds used for hypothesis testing. The analysis is achieved by the following:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">heart</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">heart</span><span class="op">)</span><span class="op">]</span>
<span class="va">lm_vim_sbp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vim.html">vim</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fl">1</span>, run_regression <span class="op">=</span> <span class="cn">TRUE</span>, SL.library <span class="op">=</span> <span class="st">"SL.lm"</span>, type <span class="op">=</span> <span class="st">"r_squared"</span><span class="op">)</span>
<span class="va">lm_vim_tob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vim.html">vim</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fl">2</span>, run_regression <span class="op">=</span> <span class="cn">TRUE</span>, SL.library <span class="op">=</span> <span class="st">"SL.lm"</span>, type <span class="op">=</span> <span class="st">"r_squared"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in vim(Y = heart$chd, X = X, indx = 2, run_regression = TRUE, SL.library
## = "SL.lm", : Original estimate &lt; 0; returning zero.</code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_vim_ldl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vim.html">vim</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fl">3</span>, run_regression <span class="op">=</span> <span class="cn">TRUE</span>, SL.library <span class="op">=</span> <span class="st">"SL.lm"</span>, type <span class="op">=</span> <span class="st">"r_squared"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in vim(Y = heart$chd, X = X, indx = 3, run_regression = TRUE, SL.library
## = "SL.lm", : Original estimate &lt; 0; returning zero.</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_vim_adi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vim.html">vim</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fl">4</span>, run_regression <span class="op">=</span> <span class="cn">TRUE</span>, SL.library <span class="op">=</span> <span class="st">"SL.lm"</span>, type <span class="op">=</span> <span class="st">"r_squared"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in vim(Y = heart$chd, X = X, indx = 4, run_regression = TRUE, SL.library
## = "SL.lm", : Original estimate &lt; 0; returning zero.</code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_vim_fam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vim.html">vim</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fl">5</span>, run_regression <span class="op">=</span> <span class="cn">TRUE</span>, SL.library <span class="op">=</span> <span class="st">"SL.lm"</span>, type <span class="op">=</span> <span class="st">"r_squared"</span><span class="op">)</span>
<span class="va">lm_vim_tpa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vim.html">vim</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fl">6</span>, run_regression <span class="op">=</span> <span class="cn">TRUE</span>, SL.library <span class="op">=</span> <span class="st">"SL.lm"</span>, type <span class="op">=</span> <span class="st">"r_squared"</span><span class="op">)</span>
<span class="va">lm_vim_obe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vim.html">vim</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fl">7</span>, run_regression <span class="op">=</span> <span class="cn">TRUE</span>, SL.library <span class="op">=</span> <span class="st">"SL.lm"</span>, type <span class="op">=</span> <span class="st">"r_squared"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in vim(Y = heart$chd, X = X, indx = 7, run_regression = TRUE, SL.library
## = "SL.lm", : Original estimate &lt; 0; returning zero.</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_vim_alc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vim.html">vim</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fl">8</span>, run_regression <span class="op">=</span> <span class="cn">TRUE</span>, SL.library <span class="op">=</span> <span class="st">"SL.lm"</span>, type <span class="op">=</span> <span class="st">"r_squared"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in vim(Y = heart$chd, X = X, indx = 8, run_regression = TRUE, SL.library
## = "SL.lm", : Original estimate &lt; 0; returning zero.</code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_vim_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vim.html">vim</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fl">9</span>, run_regression <span class="op">=</span> <span class="cn">TRUE</span>, SL.library <span class="op">=</span> <span class="st">"SL.lm"</span>, type <span class="op">=</span> <span class="st">"r_squared"</span><span class="op">)</span>

<span class="co"># make a table with the estimates using the merge_vim() function</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_vim.html">merge_vim</a></span><span class="op">(</span><span class="va">lm_vim_sbp</span>, <span class="va">lm_vim_tob</span>, <span class="va">lm_vim_ldl</span>, <span class="va">lm_vim_adi</span>,
                <span class="va">lm_vim_fam</span>, <span class="va">lm_vim_tpa</span>, <span class="va">lm_vim_obe</span>, <span class="va">lm_vim_alc</span>, <span class="va">lm_vim_age</span><span class="op">)</span>
<span class="co"># print out the matrix</span>
<span class="va">lm_mat</span></code></pre></div>
<pre><code>## Variable importance estimates:
##       Estimate   SE         95% CI                   VIMP &gt; 0 p-value   
## s = 9 0.13103142 0.06487123 [0.003886152, 0.2581767]  TRUE    0.02169846
## s = 6 0.06811560 0.06509051 [0.000000000, 0.1956907] FALSE    0.14767086
## s = 1 0.05216276 0.06436184 [0.000000000, 0.1783096] FALSE    0.20883764
## s = 5 0.04812513 0.06276984 [0.000000000, 0.1711517] FALSE    0.22163233
## s = 2 0.00000000 0.06322478 [0.000000000, 0.1239183] FALSE    0.58737127
## s = 3 0.00000000 0.06355300 [0.000000000, 0.1245616] FALSE    0.58097486
## s = 4 0.00000000 0.06460803 [0.000000000, 0.1266294] FALSE    0.61381924
## s = 7 0.00000000 0.06458195 [0.000000000, 0.1265783] FALSE    0.60874835
## s = 8 0.00000000 0.06447907 [0.000000000, 0.1263767] FALSE    0.66773221</code></pre>
</div>
<div id="building-a-library-of-learners" class="section level3">
<h3 class="hasAnchor">
<a href="#building-a-library-of-learners" class="anchor" aria-hidden="true"></a>Building a library of learners</h3>
<p>In general, we don’t believe that a linear model truly holds. Thinking about potential model misspecification leads us to consider other algorithms. Suppose that I prefer to use generalized additive models <span class="citation">(Hastie and Tibshirani 1990)</span> to estimate <span class="math inline">\(\mu_{P_0}\)</span> and <span class="math inline">\(\mu_{P_0, s}\)</span>, so I am planning on using the <code>gam</code> package. Suppose that you prefer to use the elastic net <span class="citation">(Zou and Hastie 2005)</span>, and are planning to use the <code>glmnet</code> package.</p>
<p>The choice of either method is somewhat subjective, and I also will have to use a technique like cross-validation to determine an optimal tuning parameter in each case. It is also possible that neither additive models nor the elastic net will do a good job estimating the true conditional means!</p>
<p>This motivates using <code>SuperLearner</code> to allow the data to determine the optimal combination of <em>base learners</em> from a <em>library</em> that I define. These base learners are a combination of different methods (e.g., generalized additive models and elastic net) and instances of the same method with different tuning parameter values (e.g., additive models with 3 and 4 degrees of freedom). The Super Learner is an example of model stacking, or model aggregation — these approaches use a data-adaptive combination of base learners to make predictions.</p>
<p>For instance, my library could include the elastic net, random forests <span class="citation">(Breiman 2001)</span>, and gradient boosted trees <span class="citation">(Friedman 2001)</span> as follows:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create a function for boosted stumps</span>
<span class="va">SL.gbm.1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">interaction.depth</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/SuperLearner/man/write.SL.template.html" class="external-link">SL.gbm</a></span><span class="op">(</span><span class="va">...</span>, interaction.depth <span class="op">=</span> <span class="va">interaction.depth</span><span class="op">)</span>

<span class="co"># create GAMs with different degrees of freedom</span>
<span class="va">SL.gam.3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">deg.gam</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/SuperLearner/man/write.SL.template.html" class="external-link">SL.gam</a></span><span class="op">(</span><span class="va">...</span>, deg.gam <span class="op">=</span> <span class="va">deg.gam</span><span class="op">)</span>
<span class="va">SL.gam.4</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">deg.gam</span> <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/SuperLearner/man/write.SL.template.html" class="external-link">SL.gam</a></span><span class="op">(</span><span class="va">...</span>, deg.gam <span class="op">=</span> <span class="va">deg.gam</span><span class="op">)</span>
<span class="va">SL.gam.5</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">deg.gam</span> <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/SuperLearner/man/write.SL.template.html" class="external-link">SL.gam</a></span><span class="op">(</span><span class="va">...</span>, deg.gam <span class="op">=</span> <span class="va">deg.gam</span><span class="op">)</span>

<span class="co"># add more levels of alpha for glmnet</span>
<span class="va">create.SL.glmnet</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">alpha</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">mm</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">parse</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">""</span>, text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'SL.glmnet.'</span>, <span class="va">alpha</span><span class="op">[</span><span class="va">mm</span><span class="op">]</span>, <span class="st">'&lt;- function(..., alpha = '</span>, <span class="va">alpha</span><span class="op">[</span><span class="va">mm</span><span class="op">]</span>, <span class="st">') SL.glmnet(..., alpha = alpha)'</span>, sep <span class="op">=</span> <span class="st">''</span><span class="op">)</span><span class="op">)</span>, envir <span class="op">=</span> <span class="va">.GlobalEnv</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu">create.SL.glmnet</span><span class="op">(</span><span class="op">)</span>

<span class="co"># add tuning parameters for randomForest</span>
<span class="va">create.SL.randomForest</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tune</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mtry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span>, nodesize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tuneGrid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="va">tune</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">mm</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tuneGrid</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">parse</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">""</span>, text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"SL.randomForest."</span>, <span class="va">mm</span>, <span class="st">"&lt;- function(..., mtry = "</span>, <span class="va">tuneGrid</span><span class="op">[</span><span class="va">mm</span>, <span class="fl">1</span><span class="op">]</span>, <span class="st">", nodesize = "</span>, <span class="va">tuneGrid</span><span class="op">[</span><span class="va">mm</span>, <span class="fl">2</span><span class="op">]</span>, <span class="st">") SL.randomForest(..., mtry = mtry, nodesize = nodesize)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span>, envir <span class="op">=</span> <span class="va">.GlobalEnv</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu">create.SL.randomForest</span><span class="op">(</span><span class="op">)</span>

<span class="co"># create the library</span>
<span class="va">learners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.glmnet"</span>, <span class="st">"SL.glmnet.0.25"</span>, <span class="st">"SL.glmnet.0.5"</span>, <span class="st">"SL.glmnet.0.75"</span>,
              <span class="st">"SL.randomForest"</span>, <span class="st">"SL.randomForest.1"</span>, <span class="st">"SL.randomForest.2"</span>, <span class="st">"SL.randomForest.3"</span>,
              <span class="st">"SL.randomForest.4"</span>, <span class="st">"SL.randomForest.5"</span>, <span class="st">"SL.randomForest.6"</span>, <span class="st">"SL.randomForest.7"</span>,
              <span class="st">"SL.randomForest.8"</span>, <span class="st">"SL.randomForest.9"</span>,
              <span class="st">"SL.gbm.1"</span><span class="op">)</span></code></pre></div>
<p>Now that I have created the library of learners, I can move on to estimating variable importance.</p>
</div>
<div id="estimating-variable-importance-for-a-single-variable" class="section level3">
<h3 class="hasAnchor">
<a href="#estimating-variable-importance-for-a-single-variable" class="anchor" aria-hidden="true"></a>Estimating variable importance for a single variable</h3>
<p>The main function for R-squared-based variable importance in the <code>vimp</code> package is the <code><a href="../reference/vimp_rsquared.html">vimp_rsquared()</a></code> function. There are five main arguments to <code><a href="../reference/vimp_rsquared.html">vimp_rsquared()</a></code>:</p>
<ul>
<li>
<code>Y</code>, the outcome</li>
<li>
<code>X</code>, the covariates</li>
<li>
<code>indx</code>, which determines the feature I want to estimate variable importance for</li>
<li>
<code>SL.library</code>, the library of candidate learners</li>
<li>
<code>V</code>, the number of cross-validation folds to use for computing variable importance</li>
</ul>
<p>The main arguments differ if precomputed regression function estimates are used; please see <a href="precomputed-regressions.html">“Using precomputed regression function estimates in <code>vimp</code>”</a> for further discussion of this case.</p>
<p>Suppose that the first feature that I want to estimate variable importance for is family history of heart disease, <code>fam</code>. Then supplying <code><a href="../reference/vimp_rsquared.html">vimp_rsquared()</a></code> with</p>
<ul>
<li><code>Y = heart$chd</code></li>
<li><code>X = X</code></li>
<li><code>indx = 5</code></li>
<li><code>SL.library = learners</code></li>
<li><code>V = 5</code></li>
</ul>
<p>means that:</p>
<ul>
<li>I want to use <code><a href="https://rdrr.io/pkg/SuperLearner/man/SuperLearner.html" class="external-link">SuperLearner()</a></code> to estimate the conditional means <span class="math inline">\(\mu_{P_0}\)</span> and <span class="math inline">\(\mu_{P_0,s}\)</span>, and my candidate library is <code>learners</code>
</li>
<li>I want to estimate variable importance for the fifth column of the South African heart disease study covariates, which is <code>fam</code>
</li>
<li>I want to use five-fold cross-fitting to estimate importance</li>
</ul>
<p>The call to <code><a href="../reference/vimp_rsquared.html">vimp_rsquared()</a></code> looks like this:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/vimp_rsquared.html">vimp_rsquared</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>,
    indx <span class="op">=</span> <span class="fl">5</span>, run_regression <span class="op">=</span> <span class="cn">TRUE</span>, SL.library <span class="op">=</span> <span class="va">learners</span>, V <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p>While this is the preferred method for estimating variable importance, using a large library of learners may cause the function to take time to run. Usually this is okay — in general, you took a long time to collect the data, so letting an algorithm run for a few hours should not be an issue.</p>
<p>However, for the sake of illustration, I can estimate varibable importance for family history only using only using a small library, a small number of cross-validation folds in the Super Learner, and a small number of cross-fitting folds as follows (again, I suggest using a larger number of folds and a larger library in practice):</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># small learners library</span>
<span class="va">learners.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.ranger"</span><span class="op">)</span>
<span class="co"># small number of cross-fitting folds</span>
<span class="va">V</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="co"># small number of CV folds for Super Learner</span>
<span class="va">sl_cvcontrol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>V <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="co"># now estimate variable importance</span>
<span class="va">start_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">fam_vim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vimp_rsquared.html">vimp_rsquared</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fl">5</span>, SL.library <span class="op">=</span> <span class="va">learners.2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span>, V <span class="op">=</span> <span class="va">V</span>, cvControl <span class="op">=</span> <span class="va">sl_cvcontrol</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in cv_vim(type = "r_squared", Y = Y, X = X, cross_fitted_f1 =
## cross_fitted_f1, : Original estimate &lt; 0; returning zero.</code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">end_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>This code takes approximately 3.153 seconds to run on a (not very fast) PC. I can display these estimates:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fam_vim</span></code></pre></div>
<pre><code>## Variable importance estimates:
##       Estimate SE         95% CI         VIMP &gt; 0 p-value  
## s = 5 0        0.05779144 [0, 0.1132691] FALSE    0.9879031</code></pre>
<p>The object returned by <code><a href="../reference/vimp_rsquared.html">vimp_rsquared()</a></code> also contains fitted values from using <code><a href="https://rdrr.io/pkg/SuperLearner/man/SuperLearner.html" class="external-link">SuperLearner()</a></code>; I access these using <code>$full_fit</code> and <code>$red_fit</code>. For example,</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fam_vim</span><span class="op">$</span><span class="va">full_fit</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
##   [1] 0.660 0.510 0.274 0.686 0.362 0.732 0.396 0.812 0.198 0.394 0.214 0.172
##  [13] 0.146 0.552 0.110 0.134 0.230 0.622 0.044 0.240 0.572 0.264 0.002 0.580
##  [25] 0.472 0.524 0.092 0.284 0.508 0.596 0.538 0.134 0.286 0.434 0.000 0.654
##  [37] 0.106 0.002 0.584 0.520 0.810 0.244 0.232 0.142 0.500 0.246 0.320 0.034
##  [49] 0.662 0.192 0.672 0.352 0.518 0.504 0.176 0.066 0.554 0.046 0.566 0.404
##  [61] 0.452 0.018 0.464 0.340 0.252 0.266 0.170 0.604 0.018 0.008 0.002 0.148
##  [73] 0.250 0.238 0.188 0.282 0.232 0.334 0.224 0.368 0.232 0.308 0.330 0.250
##  [85] 0.314 0.316 0.336 0.426 0.630 0.258 0.180 0.410 0.716 0.596 0.562 0.262
##  [97] 0.100 0.636 0.580 0.624 0.052 0.200 0.182 0.338 0.068 0.116 0.042 0.170
## [109] 0.320 0.392 0.394 0.378 0.570 0.366 0.316 0.318
## 
## [[2]]
##   [1] 0.2340000 0.7140000 0.0940000 0.4460000 0.2340000 0.4220000 0.2740000
##   [8] 0.7040000 0.2460000 0.1440000 0.2380000 0.2960000 0.3140000 0.2240000
##  [15] 0.0160000 0.1920000 0.3720000 0.1260000 0.4580000 0.4440000 0.2820000
##  [22] 0.1840000 0.0600000 0.3500000 0.4130000 0.0500000 0.3180000 0.1400000
##  [29] 0.8500000 0.2420000 0.2200000 0.5920000 0.2960000 0.3360000 0.6280000
##  [36] 0.1520000 0.0180000 0.4400000 0.5000000 0.1100000 0.3040000 0.2300000
##  [43] 0.0140000 0.6760000 0.6880000 0.4400000 0.0280000 0.0220000 0.3760000
##  [50] 0.0700000 0.8260000 0.3360000 0.5580000 0.4420000 0.4720000 0.1640000
##  [57] 0.4500000 0.7720000 0.5060000 0.5280000 0.1200000 0.4946667 0.4140000
##  [64] 0.0760000 0.2400000 0.4280000 0.7440000 0.2280000 0.2480000 0.3620000
##  [71] 0.2320000 0.4948000 0.4260000 0.3200000 0.0680000 0.4660000 0.3100000
##  [78] 0.0820000 0.7320000 0.3360000 0.3900000 0.5940000 0.3140000 0.6600000
##  [85] 0.3040000 0.3220000 0.6260000 0.5140000 0.0120000 0.3640000 0.5560000
##  [92] 0.5660000 0.4580000 0.0600000 0.5000000 0.3900000 0.5700000 0.3040000
##  [99] 0.1860000 0.1160000 0.4520000 0.3560000 0.1360000 0.2880000 0.2630000
## [106] 0.4040000 0.3880000 0.5180000 0.1160000 0.0900000 0.2200000 0.0788000
## [113] 0.2640000 0.1180000 0.7290000 0.3720000
## 
## [[3]]
##   [1] 0.73400000 0.39600000 0.47800000 0.39200000 0.07800000 0.80800000
##   [7] 0.21000000 0.40800000 0.34600000 0.33600000 0.12000000 0.19400000
##  [13] 0.09400000 0.69200000 0.32400000 0.17800000 0.23200000 0.45300000
##  [19] 0.40400000 0.62400000 0.18000000 0.46800000 0.18200000 0.37000000
##  [25] 0.10600000 0.14400000 0.35000000 0.75800000 0.37200000 0.13200000
##  [31] 0.71200000 0.51000000 0.64600000 0.41000000 0.26800000 0.10400000
##  [37] 0.51200000 0.59600000 0.18800000 0.64200000 0.08000000 0.45700000
##  [43] 0.03600000 0.74200000 0.57600000 0.11600000 0.66600000 0.46000000
##  [49] 0.02000000 0.28000000 0.31200000 0.52000000 0.19800000 0.64800000
##  [55] 0.22200000 0.33400000 0.10600000 0.64200000 0.44000000 0.36400000
##  [61] 0.40200000 0.69600000 0.43000000 0.61200000 0.02000000 0.28866667
##  [67] 0.45800000 0.62600000 0.15400000 0.11600000 0.69000000 0.72200000
##  [73] 0.05000000 0.29400000 0.01866667 0.12000000 0.07800000 0.48200000
##  [79] 0.27800000 0.59800000 0.39400000 0.30200000 0.63800000 0.53400000
##  [85] 0.51200000 0.01800000 0.24200000 0.52000000 0.18000000 0.39100000
##  [91] 0.13400000 0.23800000 0.26800000 0.07800000 0.64600000 0.77800000
##  [97] 0.26466667 0.59000000 0.53800000 0.55200000 0.08200000 0.22400000
## [103] 0.48600000 0.26000000 0.52400000 0.63200000 0.52800000 0.24900000
## [109] 0.11400000 0.05400000 0.03200000 0.20400000 0.16800000 0.31400000
## [115] 0.54600000
## 
## [[4]]
##   [1] 0.2060000 0.2380000 0.0340000 0.5160000 0.5000000 0.7720000 0.5520000
##   [8] 0.4520000 0.6240000 0.2980000 0.3360000 0.2860000 0.3300000 0.3200000
##  [15] 0.2100000 0.0890000 0.0500000 0.2220000 0.1300000 0.6640000 0.3680000
##  [22] 0.5660000 0.3100000 0.4760000 0.4260000 0.1220000 0.1380000 0.4720000
##  [29] 0.2720000 0.5080000 0.6900000 0.1700000 0.1720000 0.1600000 0.5020000
##  [36] 0.1180000 0.2340000 0.8240000 0.1220000 0.3360000 0.0120000 0.2140000
##  [43] 0.3840000 0.4140000 0.2140000 0.3120000 0.0280000 0.1340000 0.5820000
##  [50] 0.1720000 0.2280000 0.1880000 0.2740000 0.2440000 0.4340000 0.5340000
##  [57] 0.6053333 0.0660000 0.1140000 0.2420000 0.4760000 0.4020000 0.2320000
##  [64] 0.0200000 0.7080000 0.3040000 0.5540000 0.4400000 0.3260000 0.3393333
##  [71] 0.6360000 0.7160000 0.0750000 0.3400000 0.5180000 0.4020000 0.2340000
##  [78] 0.0300000 0.5040000 0.0500000 0.1820000 0.3860000 0.6200000 0.5980000
##  [85] 0.1240000 0.4320000 0.7180000 0.4620000 0.3340000 0.5060000 0.2660000
##  [92] 0.3900000 0.5140000 0.4540000 0.4600000 0.3700000 0.3240000 0.5960000
##  [99] 0.6600000 0.5320000 0.4780000 0.5800000 0.5280000 0.5260000 0.4600000
## [106] 0.5640000 0.2120000 0.4320000 0.2842000 0.0340000 0.0220000 0.0300000
## [113] 0.0260000 0.1560000 0.1980000</code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fam_vim</span><span class="op">$</span><span class="va">red_fit</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
##   [1] 0.59860653 0.43833539 0.27635390 0.43302311 0.48959534 0.52485778
##   [7] 0.40980582 0.58455450 0.29352488 0.43117214 0.34943923 0.25280044
##  [13] 0.13951684 0.41421082 0.15959801 0.17056926 0.24406305 0.57810278
##  [19] 0.11778732 0.24159275 0.59635830 0.35813771 0.04642957 0.50105178
##  [25] 0.35146607 0.51591687 0.19462661 0.32451947 0.53214885 0.65485116
##  [31] 0.57892199 0.14884104 0.41057887 0.51222328 0.05549039 0.57172957
##  [37] 0.17996003 0.06021333 0.38896491 0.45952124 0.48601394 0.34929674
##  [43] 0.21784457 0.25306569 0.55829740 0.23313327 0.21150357 0.07835055
##  [49] 0.48698961 0.33314033 0.50107132 0.46033022 0.51430390 0.47656858
##  [55] 0.17876186 0.14208570 0.36203602 0.11929152 0.41084533 0.37831483
##  [61] 0.42838694 0.20449862 0.29329073 0.44756043 0.40990409 0.37170437
##  [67] 0.37709519 0.53860860 0.07374296 0.08295367 0.06743101 0.18931917
##  [73] 0.30543939 0.30269751 0.13692079 0.25236723 0.20986975 0.51843193
##  [79] 0.20048871 0.44299152 0.30071714 0.38448537 0.29014955 0.28582428
##  [85] 0.49514344 0.24531733 0.25294320 0.46601147 0.52398446 0.24734114
##  [91] 0.18479740 0.35669350 0.55009197 0.49333548 0.59487724 0.26459537
##  [97] 0.15055361 0.50167467 0.45828683 0.57020193 0.11997897 0.27716963
## [103] 0.25517053 0.35040453 0.14979118 0.19738952 0.07538611 0.29788264
## [109] 0.31616802 0.56097397 0.25366625 0.31657163 0.49850385 0.51482280
## [115] 0.38834914 0.35118665
## 
## [[2]]
##   [1] 0.40611402 0.43487227 0.12037982 0.53973611 0.26702936 0.56453594
##   [7] 0.46064413 0.57532513 0.13727913 0.14210098 0.31294568 0.31767673
##  [13] 0.38315622 0.19951611 0.05295591 0.44136420 0.40014254 0.05698310
##  [19] 0.45198142 0.52952233 0.46638391 0.21312281 0.24124802 0.45852929
##  [25] 0.45815107 0.19323841 0.34540164 0.24466502 0.57261453 0.40372413
##  [31] 0.17909474 0.36508706 0.27247606 0.58526598 0.31815163 0.18668521
##  [37] 0.03394133 0.58539291 0.39955546 0.13736228 0.29673540 0.22196154
##  [43] 0.05009863 0.38883886 0.41182564 0.65043057 0.13371783 0.06475639
##  [49] 0.54073860 0.14567523 0.53236047 0.35559400 0.54637367 0.58790998
##  [55] 0.56237287 0.38257753 0.51258672 0.58776787 0.28121568 0.58527200
##  [61] 0.13100276 0.31492440 0.56781020 0.14648956 0.26151819 0.44260206
##  [67] 0.58403662 0.30862329 0.43291218 0.35487932 0.36490938 0.45634443
##  [73] 0.48607691 0.36622149 0.18351106 0.41418064 0.26547035 0.13872361
##  [79] 0.54728976 0.53609253 0.41153560 0.46728864 0.35309176 0.46293847
##  [85] 0.34121715 0.40686473 0.54027440 0.37198080 0.14694473 0.45140090
##  [91] 0.40513771 0.60049702 0.29554597 0.21055552 0.27849044 0.33272571
##  [97] 0.34720210 0.36050666 0.26615975 0.26024459 0.43987527 0.44818870
## [103] 0.21956124 0.32092727 0.27611466 0.40477853 0.57754190 0.28903943
## [109] 0.14874186 0.25706160 0.20835127 0.05823104 0.29462739 0.24476576
## [115] 0.40447646 0.43318590
## 
## [[3]]
##   [1] 0.51071073 0.43569717 0.44233978 0.43265993 0.08290845 0.66305057
##   [7] 0.38301211 0.37222493 0.41819906 0.53421540 0.07280332 0.34896447
##  [13] 0.14816507 0.55496247 0.33024083 0.26338774 0.09453721 0.41773118
##  [19] 0.33934692 0.54224234 0.06251933 0.23542330 0.30617677 0.27279012
##  [25] 0.18577963 0.38097508 0.24040680 0.52810391 0.37922367 0.20943437
##  [31] 0.60535296 0.45195043 0.43910518 0.32317921 0.34350256 0.20145883
##  [37] 0.56787672 0.55562033 0.42379110 0.50958597 0.17982831 0.51131191
##  [43] 0.05866786 0.51762599 0.38088904 0.26302203 0.46862446 0.39563559
##  [49] 0.05167929 0.35977693 0.28668963 0.39723329 0.17123442 0.47756808
##  [55] 0.27945386 0.37827132 0.17216927 0.57642549 0.41935182 0.42705908
##  [61] 0.39554698 0.63798633 0.50005823 0.45169332 0.08617595 0.29259756
##  [67] 0.47711033 0.47831261 0.11528111 0.12676937 0.57954243 0.51745190
##  [73] 0.05816174 0.32882134 0.06928509 0.27204238 0.09680968 0.47670113
##  [79] 0.25807140 0.53602130 0.36322623 0.31970114 0.54855656 0.43206447
##  [85] 0.52527723 0.10945748 0.40322574 0.55382427 0.17579628 0.38481377
##  [91] 0.25783960 0.23590360 0.18861380 0.12986650 0.43391918 0.54431646
##  [97] 0.28032953 0.47645838 0.47921703 0.44682328 0.10834477 0.42926054
## [103] 0.49603686 0.24939182 0.35670793 0.50624744 0.33769384 0.32421988
## [109] 0.10633588 0.16333185 0.04485378 0.20373328 0.16580830 0.20991739
## [115] 0.49100157
## 
## [[4]]
##   [1] 0.25612540 0.26779717 0.06696992 0.37489217 0.41212327 0.58869997
##   [7] 0.41799526 0.48117661 0.49863460 0.31546729 0.28587221 0.32850137
##  [13] 0.36361313 0.37007795 0.34731039 0.10350787 0.08748199 0.21341360
##  [19] 0.12611274 0.32939410 0.23731172 0.40572531 0.59104913 0.60819060
##  [25] 0.55303839 0.26154498 0.19489843 0.31819963 0.38723512 0.55356147
##  [31] 0.50058043 0.28129242 0.25858724 0.18259644 0.46013750 0.19773573
##  [37] 0.44836951 0.63938985 0.31914537 0.21431757 0.08227705 0.33456590
##  [43] 0.29892767 0.22783746 0.31227380 0.42172814 0.12411813 0.07718868
##  [49] 0.48705200 0.27446759 0.32644966 0.35046283 0.40467279 0.29703668
##  [55] 0.38384943 0.62111433 0.49786009 0.15797250 0.15573082 0.26067069
##  [61] 0.54520604 0.37699559 0.27975298 0.06545858 0.37808339 0.36546833
##  [67] 0.45310587 0.51807463 0.32899357 0.32714995 0.44316425 0.39950210
##  [73] 0.08478478 0.47836120 0.36387740 0.08547730 0.19138030 0.04516800
##  [79] 0.47415963 0.13689449 0.24415809 0.32062477 0.36280514 0.58101494
##  [85] 0.17438829 0.50928013 0.43625581 0.47147617 0.27487372 0.42489513
##  [91] 0.38331753 0.29252586 0.46181730 0.33002780 0.51988767 0.47229023
##  [97] 0.54544193 0.52590190 0.53854577 0.56118007 0.53870637 0.55651640
## [103] 0.58815781 0.60848857 0.41171299 0.53138510 0.29009637 0.24655277
## [109] 0.13015160 0.08339928 0.04436679 0.06201441 0.10487974 0.36896083
## [115] 0.08487703</code></pre>
<p>I can obtain estimates for the remaining individual features in the same way (again using only using a small library for illustration):</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># estimate variable importance</span>
<span class="va">tpa_vim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vimp_rsquared.html">vimp_rsquared</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fl">6</span>, SL.library <span class="op">=</span> <span class="va">learners.2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span>, V <span class="op">=</span> <span class="va">V</span>, cvControl <span class="op">=</span> <span class="va">sl_cvcontrol</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in cv_vim(type = "r_squared", Y = Y, X = X, cross_fitted_f1 =
## cross_fitted_f1, : Original estimate &lt; 0; returning zero.</code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">alc_vim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vimp_rsquared.html">vimp_rsquared</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fl">8</span>, SL.library <span class="op">=</span> <span class="va">learners.2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span>, V <span class="op">=</span> <span class="va">V</span>, cvControl <span class="op">=</span> <span class="va">sl_cvcontrol</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in cv_vim(type = "r_squared", Y = Y, X = X, cross_fitted_f1 =
## cross_fitted_f1, : Original estimate &lt; 0; returning zero.</code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sbp_vim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vimp_rsquared.html">vimp_rsquared</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fl">1</span>, SL.library <span class="op">=</span> <span class="va">learners.2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span>, V <span class="op">=</span> <span class="va">V</span>, cvControl <span class="op">=</span> <span class="va">sl_cvcontrol</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in cv_vim(type = "r_squared", Y = Y, X = X, cross_fitted_f1 =
## cross_fitted_f1, : Original estimate &lt; 0; returning zero.</code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tob_vim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vimp_rsquared.html">vimp_rsquared</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fl">2</span>, SL.library <span class="op">=</span> <span class="va">learners.2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span>, V <span class="op">=</span> <span class="va">V</span>, cvControl <span class="op">=</span> <span class="va">sl_cvcontrol</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in cv_vim(type = "r_squared", Y = Y, X = X, cross_fitted_f1 =
## cross_fitted_f1, : Original estimate &lt; 0; returning zero.</code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ldl_vim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vimp_rsquared.html">vimp_rsquared</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fl">3</span>, SL.library <span class="op">=</span> <span class="va">learners.2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span>, V <span class="op">=</span> <span class="va">V</span>, cvControl <span class="op">=</span> <span class="va">sl_cvcontrol</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in cv_vim(type = "r_squared", Y = Y, X = X, cross_fitted_f1 =
## cross_fitted_f1, : Original estimate &lt; 0; returning zero.</code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">adi_vim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vimp_rsquared.html">vimp_rsquared</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fl">4</span>, SL.library <span class="op">=</span> <span class="va">learners.2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span>, V <span class="op">=</span> <span class="va">V</span>, cvControl <span class="op">=</span> <span class="va">sl_cvcontrol</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in cv_vim(type = "r_squared", Y = Y, X = X, cross_fitted_f1 =
## cross_fitted_f1, : Original estimate &lt; 0; returning zero.</code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obe_vim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vimp_rsquared.html">vimp_rsquared</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fl">7</span>, SL.library <span class="op">=</span> <span class="va">learners.2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span>, V <span class="op">=</span> <span class="va">V</span>, cvControl <span class="op">=</span> <span class="va">sl_cvcontrol</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in cv_vim(type = "r_squared", Y = Y, X = X, cross_fitted_f1 =
## cross_fitted_f1, : Original estimate &lt; 0; returning zero.</code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">age_vim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vimp_rsquared.html">vimp_rsquared</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fl">9</span>, SL.library <span class="op">=</span> <span class="va">learners.2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span>, V <span class="op">=</span> <span class="va">V</span>, cvControl <span class="op">=</span> <span class="va">sl_cvcontrol</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in cv_vim(type = "r_squared", Y = Y, X = X, cross_fitted_f1 =
## cross_fitted_f1, : Original estimate &lt; 0; returning zero.</code></pre>
<p>Now that I have estimates of each of individual feature’s variable importance, I can view them all simultaneously by plotting:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://tibble.tidyverse.org/" class="external-link">"tibble"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://wilkelab.org/cowplot/" class="external-link">"cowplot"</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/theme_cowplot.html" class="external-link">theme_cowplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co"># combine the objects together</span>
<span class="va">ests</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_vim.html">merge_vim</a></span><span class="op">(</span><span class="va">sbp_vim</span>, <span class="va">tob_vim</span>, <span class="va">ldl_vim</span>, <span class="va">adi_vim</span>,
                <span class="va">fam_vim</span>, <span class="va">tpa_vim</span>, <span class="va">obe_vim</span>, <span class="va">alc_vim</span>, <span class="va">age_vim</span><span class="op">)</span>
<span class="va">all_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sys. blood press."</span>, <span class="st">"Tobacco consump."</span>, <span class="st">"LDL cholesterol"</span>,
              <span class="st">"Adiposity"</span>, <span class="st">"Family history"</span>, <span class="st">"Type A behavior"</span>, <span class="st">"Obesity"</span>,
              <span class="st">"Alcohol consump."</span>, <span class="st">"Age"</span><span class="op">)</span>

<span class="va">est_plot_tib</span> <span class="op">&lt;-</span> <span class="va">ests</span><span class="op">$</span><span class="va">mat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    var_fct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">s</span>, levels <span class="op">=</span> <span class="va">ests</span><span class="op">$</span><span class="va">mat</span><span class="op">$</span><span class="va">s</span>,
                     labels <span class="op">=</span> <span class="va">all_vars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">ests</span><span class="op">$</span><span class="va">mat</span><span class="op">$</span><span class="va">s</span><span class="op">)</span><span class="op">]</span>,
                     ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co"># plot</span>
<span class="va">est_plot_tib</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">est</span>, y <span class="op">=</span> <span class="va">var_fct</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_errorbarh.html" class="external-link">geom_errorbarh</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">cil</span>, xmax <span class="op">=</span> <span class="va">ciu</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Variable importance estimates: "</span>, <span class="va">R</span><span class="op">^</span><span class="fl">2</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Estimated individual feature importance"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"in the South African heart disease study data"</span><span class="op">)</span></code></pre></div>
<p><img src="introduction-to-vimp_files/figure-html/heart-vim-1.png" width="816"></p>
</div>
</div>
<div id="estimating-variable-importance-for-a-group-of-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#estimating-variable-importance-for-a-group-of-variables" class="anchor" aria-hidden="true"></a>Estimating variable importance for a group of variables</h2>
<p>Now that I have estimated variable importance for each of the individual features, I can estimate variable importance for each of the groups that I mentioned above: biological and behavioral features.</p>
<p>The only difference between estimating variable importance for a group of features rather than an individual feature is that now I specify a vector for <code>s</code>; I can use any of the options listed in the previous section to compute these estimates.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get the estimates</span>
<span class="va">behav_vim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vimp_rsquared.html">vimp_rsquared</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span>, SL.library <span class="op">=</span> <span class="va">learners.2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span>, V <span class="op">=</span> <span class="va">V</span>, cvControl <span class="op">=</span> <span class="va">sl_cvcontrol</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in cv_vim(type = "r_squared", Y = Y, X = X, cross_fitted_f1 =
## cross_fitted_f1, : Original estimate &lt; 0; returning zero.</code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bios_vim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vimp_rsquared.html">vimp_rsquared</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">heart</span><span class="op">$</span><span class="va">chd</span>, X <span class="op">=</span> <span class="va">X</span>, indx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">9</span><span class="op">)</span>, SL.library <span class="op">=</span> <span class="va">learners.2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span>, V <span class="op">=</span> <span class="va">V</span>, cvControl <span class="op">=</span> <span class="va">sl_cvcontrol</span><span class="op">)</span>

<span class="co"># combine and plot</span>
<span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_vim.html">merge_vim</a></span><span class="op">(</span><span class="va">behav_vim</span>, <span class="va">bios_vim</span><span class="op">)</span>
<span class="va">all_grp_nms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Behavioral features"</span>, <span class="st">"Biological features"</span><span class="op">)</span>

<span class="va">grp_plot_tib</span> <span class="op">&lt;-</span> <span class="va">groups</span><span class="op">$</span><span class="va">mat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    grp_fct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span>
      <span class="va">s</span> <span class="op">==</span> <span class="st">"2,6,8"</span> <span class="op">~</span> <span class="st">"1"</span>,
      <span class="va">s</span> <span class="op">==</span> <span class="st">"1,3,4,5,7,9"</span> <span class="op">~</span> <span class="st">"2"</span>
    <span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span><span class="op">)</span>,  labels <span class="op">=</span> <span class="va">all_grp_nms</span>, ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">)</span>
<span class="va">grp_plot_tib</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">est</span>, y <span class="op">=</span> <span class="va">grp_fct</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_errorbarh.html" class="external-link">geom_errorbarh</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">cil</span>, xmax <span class="op">=</span> <span class="va">ciu</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Variable importance estimates: "</span>, <span class="va">R</span><span class="op">^</span><span class="fl">2</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Estimated feature group importance"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"in the South African heart disease study data"</span><span class="op">)</span></code></pre></div>
<p><img src="introduction-to-vimp_files/figure-html/heart-group-vim-1.png" width="816"></p>
</div>
<div id="types-of-population-variable-importance" class="section level2">
<h2 class="hasAnchor">
<a href="#types-of-population-variable-importance" class="anchor" aria-hidden="true"></a>Types of population variable importance</h2>
<p>In this document, I have focused on one particular definition of population variable importance that I call <em>conditional</em> variable importance. For a further discussion of what I call <em>marginal</em> variable importance and <em>Shapley population</em> variable importance, please see <a href="types-of-vims.html">“Types of VIMs”</a>.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor" aria-hidden="true"></a>References</h2>
<div id="refs" class="references">
<div id="ref-breiman2001">
<p>Breiman, L. 2001. “Random Forests” 45.</p>
</div>
<div id="ref-friedman2001">
<p>Friedman, JH. 2001. “Greedy Function Approximation: A Gradient Boosting Machine.”</p>
</div>
<div id="ref-hastie1990">
<p>Hastie, TJ, and RJ Tibshirani. 1990. <em>Generalized Additive Models</em>. Vol. 43. CRC Press.</p>
</div>
<div id="ref-hastie2009">
<p>Hastie, T, R Tibshirani, and J Friedman. 2009. <em>The Elements of Statistical Learning</em>.</p>
</div>
<div id="ref-vanderlaan2007">
<p>van der Laan, MJ, EC Polley, and AE Hubbard. 2007. “Super Learner” 6.</p>
</div>
<div id="ref-williamson2020c">
<p>Williamson, Brian D, and Jean Feng. 2020. “Efficient Nonparametric Statistical Inference on Population Feature Importance Using Shapley Values.” <a href="https://arxiv.org/abs/2006.09481" class="external-link">https://arxiv.org/abs/2006.09481</a>.</p>
</div>
<div id="ref-williamson2020a">
<p>Williamson, Brian D, Peter B Gilbert, Marco Carone, and Noah Simon. 2020. “Nonparametric Variable Importance Assessment Using Machine Learning Techniques.”</p>
</div>
<div id="ref-williamson2020b">
<p>Williamson, Brian D, Peter B Gilbert, Noah Simon, and Marco Carone. 2020. “A Unified Approach for Inference on Algorithm-Agnostic Variable Importance.” <a href="https://arxiv.org/abs/2004.03683" class="external-link">https://arxiv.org/abs/2004.03683</a>.</p>
</div>
<div id="ref-zou2005">
<p>Zou, H, and TJ Hastie. 2005. “Regularization and Variable Selection via the Elastic Net.”</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Brian D. Williamson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
